" Basic appearance
color desert
syntax on
set number
set relativenumber
set ruler
set hlsearch
set nolinebreak
autocmd BufNewFile,BufRead *.md setf markdown

" Indent with 4 spaces
set shiftwidth=4
set tabstop=4
set expandtab
set smartindent
set autoindent

" Remaps 
inoremap jk <Esc>
inoremap ;; <Esc>/<++><Enter>:nohlsearch<Enter>"_c4l
nnoremap ;; /<++><Enter>:nohlsearch<Enter>"_c4l
inoremap ;< <++>
nnoremap ;< a<++><Esc>
nnoremap <F2> :w<CR>

" File-specific remaps
augroup file_remaps
    autocmd!
    autocmd BufWinEnter *.tex nnoremap <F3> :w<CR>:!pdflatex '%:p'<CR>
augroup END

" Folding
set foldcolumn=1
set foldmethod=manual
augroup AutoSaveFolds
    autocmd!
    autocmd BufWinLeave * mkview
    autocmd BufWinEnter * silent loadview
    autocmd BufWinEnter * normal zR
augroup END

" Essay mode
nnoremap <F5> :call Toggle_essay()<CR>
function Toggle_essay()
    if &linebreak
        setlocal columns&vim
        setlocal nolinebreak
        unmap j
        unmap k
    else
        setlocal columns=60
        setlocal linebreak
        nnoremap j gj
        nnoremap k gk
    endif
endfunction

" File templates
augroup templates
    autocmd!
    autocmd BufNewFile *.asm 0r ~/.vim/templates/skeleton.asm
    autocmd BufNewFile *.tex 0r ~/.vim/templates/skeleton.tex
    autocmd BufNewFile *.html 0r ~/.vim/templates/skeleton.html
augroup END
